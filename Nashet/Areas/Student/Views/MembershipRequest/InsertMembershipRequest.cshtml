@model MembershipRequestViewModel
@{
    var teamList = (IEnumerable<TeamViewModel>)ViewBag.Team;
    var queryGuid = ViewContext.HttpContext.Request.Query["teamGuid"];
    Guid TeamGuid = Guid.TryParse(queryGuid, out var parsedGuid) ? parsedGuid : Guid.Empty;
}
<section class="page_wrap">
    <div class="page_content">

        <div class="block mb-4">
            <div class="block-header border-bottom px-4 py-4">
                <h5 class="m-0">رفع طلب عضوية</h5>
            </div>
            <div class="block-body py-5">
                <div class="row justify-content-center">
                    <div class="col-md-8">
                        <form asp-action="InsertMembershipRequest" asp-controller="MembershipRequest" method="post" enctype="multipart/form-data">
                            <div class="row">
                                <!-- START ITEM -->
                                <div class="col-md-6">
                                    <label asp-for="ClubGuid" class="mb-1">  </label>
                                    <select asp-for="ClubGuid" class="form-control">
                                        <option value="">-- اختر النادي --</option>
                                        @foreach (ClubViewModel club in ViewBag.Club)
                                        {
                                            <option value="@club.Guid">@club.ClubNameAR</option>
                                        }
                                    </select>
                                    <span style="color:red" asp-validation-for="ClubGuid"></span>

                                </div><!-- END ITEM -->

                                <!-- الفريق الأول -->
                                <div class="form-group mb-3">
                                    <label asp-for="RequestTeam1" class="form-label">الرغبة الأولى</label>
                                    <select id="RequestTeam1" name="RequestTeam1" class="form-control">
                                        <option value="">-- اختر الفريق --</option>
                                    </select>
                                    <span style="color:red" asp-validation-for="RequestTeam1"></span>
                                </div>

                                <!-- الفريق الثاني -->
                                <div class="form-group mb-3">
                                    <label asp-for="RequestTeam2" class="form-label">الرغبة الثانية</label>
                                    @Html.DropDownList("RequestTeam2",
                                    new SelectList(teamList, "Guid", "TeamNameAR", TeamGuid),
                                    "-- اختر الفريق --",
                                     new { @class = "form-control", onchange = "this.form.submit()" })
                                    <span style="color:red" asp-validation-for="RequestTeam2"></span>
                                </div>

                                <!-- الفريق الثالث -->
                                <div class="form-group mb-3">
                                    <label asp-for="RequestTeam3" class="form-label">الرغبة الثالثة</label>
                                    @Html.DropDownList("RequestTeam3",
                                    new SelectList(teamList, "Guid", "TeamNameAR", TeamGuid),
                                    "-- اختر الفريق --",
                                     new { @class = "form-control", onchange = "this.form.submit()" })
                                    <span style="color:red" asp-validation-for="RequestTeam3"></span>

                                     <!-- سبب التقديم -->
                                    <div class="form-group mb-3">
                                        <label asp-for="RequestReason" class="form-label"></label>
                                        <textarea asp-for="RequestReason" class="form-control" rows="3" placeholder=" سبب التقديم"></textarea>
                                        <span asp-validation-for="RequestReason" class="text-danger"></span>
                                    </div>

                                    <!-- التاريخ -->
                                    <div class="form-group mb-3">
                                        <label asp-for="RequestDate" class="form-label"></label>
                                        <input asp-for="RequestDate" type="date" class="form-control" />
                                        <span asp-validation-for="RequestDate" class="text-danger"></span>
                                    </div>

                                    <button type="submit" class="btn btn-primary w-100 mt-3">إرسال الطلب</button>
                                </div>
                            </div>
                        </form>
                        
                    </div>
                </div>
            </div>
        </div>
    </div>
</section><!-- End Page Wrap -->
@section Scripts {
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
    <script src="path/to/quicksearch.js"></script>
    <script>
             $('#ClubGuid').on('change', function () {
            var clubId = $(this).val();
            $('#RequestTeam1, #RequestTeam2, #RequestTeam3').empty().append('<option value="">-- اختر الفريق --</option>');

            if (clubId) {
                       $.getJSON('@Url.Action("GetTeamsByClubGuid", "MembershipRequest", new { area = "Student" })?id=' + clubId
                       , function (data) {
                    $.each(data, function (i, team) {
                        var option = $('<option>', {
                            value: team.Guid,
                            text: team.TeamNameAR
                        });
                        $('#RequestTeam1').append(option.clone());
                        $('#RequestTeam2').append(option.clone());
                        $('#RequestTeam3').append(option.clone());
                    });
                });
            }
        });
    </script>
}
