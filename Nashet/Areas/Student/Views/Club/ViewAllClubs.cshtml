@using Nashet.Business.ViewModels
@model IEnumerable<ClubViewModel>
@{
    var queryGuid = ViewContext.HttpContext.Request.Query["SiteGuid"];
    Guid selectedSiteGuid = Guid.Empty;

    if (!string.IsNullOrEmpty(queryGuid) && Guid.TryParse(queryGuid, out Guid parsedGuid))
    {
        selectedSiteGuid = parsedGuid;
    }

    var siteList = (IEnumerable<SiteViewModel>)ViewBag.Sites;
    var selectedSite = siteList?.FirstOrDefault(s => s.Guid == selectedSiteGuid);

    string[] headerColors = new[] { "#0f7179" }; // for colors diversity
    int colorIndex = 0;
}

<section class="page_wrap" style="background:linear-gradient(135deg,#f8f9fa,#ffffff);padding:40px 0;display:flex;justify-content:center;">
    <!-- Narrower box -->
    <div class="page_content" style="max-width:900px;width:100%;">
        <div class="block mb-4" style="border-radius:12px;overflow:hidden;box-shadow:0 6px 18px rgba(0,0,0,0.1);">

            <!-- Header -->
            <div class="block-header px-4 py-3"
                 style="background:linear-gradient(to right,#3fa7b6, #0f7179);color:#fff;border-radius:12px 12px 0 0;display:flex;justify-content-between;align-items-center;">
                <h5 class="m-0" style="font-weight:600;letter-spacing:0.5px;">الأندية الطلابية</h5>
                <!-- Search Form -->
                <form method="get" asp-action="ViewAllClubs" asp-controller="Club" asp-area="Student" class="d-flex gap-2">
                    <input type="text" name="searchText" class="form-control" placeholder=" البحث السريع ..."
                           style="border-radius:8px;box-shadow:inset 0 1px 3px rgba(0,0,0,0.1);">
                    <button type="submit" class="btn btn-primary"
                            style="background:#fff; color:#0f7179; border:none;border-radius:8px;padding:6px 16px;font-weight:500;">
                        بحث
                    </button>
                </form>
            </div>

            <!-- فلترة الجهة -->
            <div class="block-body mx-auto px-4 py-4" style="background:#ffffff;">
                <div class="col-md-6">
                    <form method="get" asp-action="ViewAllClubs" asp-controller="Club" asp-area="Student">
                        <div style="display:flex;align-items:center;background:#fdfdfd;border-radius:10px;box-shadow:0 2px 6px rgba(0,0,0,0.05);padding:12px;">
                            <label for="selectedSite" style="font-weight:600;color:#0f7179;margin-right:10px;">اختر الجهة:</label>
                            @{
                                var siteList = (IEnumerable<SiteViewModel>)ViewBag.Site;
                                var queryGuid = ViewContext.HttpContext.Request.Query["siteGuid"];
                                Guid SiteGuid = Guid.TryParse(queryGuid, out var parsedGuid) ? parsedGuid : Guid.Empty;
                            }
                            @Html.DropDownList("siteGuid",
                            new SelectList(siteList, "Guid", "SiteNameAR", SiteGuid),
                                                        "-- اختر الجهة --",
                                                        new { @class = "form-control", style = "border-radius:8px;box-shadow:inset 0 1px 3px rgba(0,0,0,0.1);", onchange = "this.form.submit()" })
                        </div>
                    </form>
                </div>
            </div>

            <!-- بداية البطاقات -->
            <div class="row px-4 pb-4" id="clubsContainer">
                @if (Model != null && Model.Any())
                {
                    foreach (var item in Model)
                    {
                        var headerColor = headerColors[colorIndex % headerColors.Length];
                        colorIndex++;

                        <div class="col-md-6 col-lg-4 mb-5 club-card">
                            <div class="card h-100 shadow-sm"
                                 style="background: linear-gradient(135deg,#eee,#ffffff); border:none;border-radius:12px;transition:transform 0.2s ease,box-shadow 0.2s ease;">
                                <a asp-action="ClubPage" asp-controller="Club" asp-area="Student" asp-route-guid="@item.Guid"
                                   class="text-decoration-none text-dark">
                                    <!-- Club header with dynamic color -->
                                    <div class="card-header d-flex justify-content-between align-items-center"
                                         style="background:@headerColor;color:#fff;border-radius:12px 12px 0 0;padding:12px 16px;">
                                        <h6 class="mb-0" style="font-weight:600;">@item.ClubNameAR</h6>
                                        <span class="badge bg-light text-dark" style="border-radius:6px;">#@item.ClubId</span>
                                    </div>
                                    <div class="card-body" style="padding:20px;text-align:center;">
                                        <!-- صورة الشعار -->
                                        <div class="mb-3">
                                            @if (!string.IsNullOrEmpty(item.ClubIcon))
                                            {
                                                <img src="@item.ClubIcon" alt="شعار النادي"
                                                     style="width:90px;height:90px;object-fit:cover;border-radius:50%;border:3px solid @headerColor;box-shadow:0 4px 10px rgba(0,0,0,0.1);">
                                            }
                                            else
                                            {
                                                <div style="width:90px;height:90px;background:#f8f9fa;border-radius:50%;display:flex;align-items:center;justify-content:center;box-shadow:inset 0 2px 4px rgba(0,0,0,0.1);">
                                                    <i class="fas fa-image text-muted"></i>
                                                </div>
                                            }
                                        </div>

                                        <!-- معلومات النادي -->
                                        <div class="mb-2" style="text-align:left;">
                                            <strong style="color:@headerColor;">الاسم الإنجليزي:</strong>
                                            <p class="mb-1 text-muted">@item.ClubNameEN</p>
                                        </div>

                                        <div class="mb-2" style="text-align:left;">
                                            <strong style="color:@headerColor;">الجهة:</strong>
                                            @{
                                                var siteName = "غير محدد";
                                                if (siteList != null && item.SiteId > 0)
                                                {
                                                    var site = siteList.FirstOrDefault(s => s.SiteId == item.SiteId);
                                                    siteName = site?.SiteNameAR ?? "غير محدد";
                                                }
                                            }
                                            <p class="mb-1 text-muted">@siteName</p>
                                        </div>
                                    </div>
                                </a>
                            </div>
                        </div>
                    }
                }
                else
                {
                    <div class="text-center text-muted py-5">
                        <p>اختر الجهة أو ابحث لعرض الأندية</p>
                    </div>
                }
            </div>
            <!-- نهاية البطاقات -->
        </div>
    </div>
</section>

<style>
    .club-card .card {
        transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

        .club-card .card:hover {
            transform: translateY(-6px) scale(1.02);
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
            cursor: pointer;
        }
</style>
