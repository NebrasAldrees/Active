@using Nashet.Business.ViewModels
@model IEnumerable<ActivityViewModel>

<section class="page_wrap" style="background:linear-gradient(135deg,#f8f9fa,#ffffff);padding:40px 0;display:flex;justify-content:center;">
    <div class="page_content" style="max-width:900px;width:100%;">
        <div class="block mb-4" style="border-radius:12px;overflow:hidden;box-shadow:0 6px 18px rgba(0,0,0,0.1);">

            <!-- Header -->
            <div class="block-header px-4 py-3"
                 style="background:linear-gradient(to right,#3fa7b6,#0f7179);color:#fff;border-radius:12px 12px 0 0;display:flex;justify-content-between;align-items-center;">
                <h5 class="m-0" style="font-weight:600;letter-spacing:0.5px;">الأنشطة</h5>
                <!-- Search Form -->
                <form method="get" asp-action="Activities" asp-controller="Activity" asp-area="Student" class="d-flex gap-2">
                    <input type="text" name="searchText" id="searchInput" class="form-control table__quick_search"
                           placeholder=" البحث عن نشاط ..."
                           style="border-radius:8px;box-shadow:inset 0 1px 3px rgba(0,0,0,0.1);">
                    <button type="submit" class="btn"
                            style="background:#fff;color:#0f7179;border:2px solid #0f7179;border-radius:8px;padding:6px 16px;font-weight:600;">
                        بحث
                    </button>
                </form>
            </div>

            <!-- فلترة النادي -->
            <div class="block-body mx-auto px-4 py-4" style="background:#ffffff;">
                <div class="col-md-6">
                    <form method="get" asp-action="Activities" asp-controller="Activity" asp-area="Student">
                        <div style="display:flex;align-items:center;background:#fdfdfd;border-radius:10px;box-shadow:0 2px 6px rgba(0,0,0,0.05);padding:12px;">
                            <label for="selectedClub" style="font-weight:600;color:#0f7179;margin-right:10px;">النادي:</label>
                            @{
                                var clubList = (IEnumerable<ClubViewModel>)ViewBag.Club;
                                var queryGuid = ViewContext.HttpContext.Request.Query["clubGuid"];
                                Guid ClubGuid = Guid.TryParse(queryGuid, out var parsedGuid) ? parsedGuid : Guid.Empty;
                            }
                            @Html.DropDownList("clubGuid",
                            new SelectList(clubList, "Guid", "ClubNameAR", ClubGuid),
                                                        "-- اختر النادي --",
                                                        new { @class = "form-control", style = "border-radius:8px;box-shadow:inset 0 1px 3px rgba(0,0,0,0.1);", onchange = "this.form.submit()" })
                        </div>
                    </form>
                </div>
            </div>

            <!-- قائمة الأنشطة -->
            <div class="row px-4 pb-4" id="activitiesList">
                @if (Model != null && Model.Any())
                {
                    foreach (var item in Model)
                    {
                        <div class="col-md-6 col-lg-4 mb-5 activity-item"
                             data-search="@item.ActivityTopic.ToLower() @item.ActivityDescription?.ToLower()">
                            <div class="card h-100 shadow-sm"
                                 style="border:none;border-radius:12px;transition:transform 0.3s ease,box-shadow 0.3s ease;">
                                <a asp-action="ActivityPage" asp-route-guid="@item.Guid" asp-controller="Activity" asp-area="ClubSupervisor"
                                   class="text-decoration-none text-dark d-block text-center p-3 h-100">
                                    <div class="mb-3">
                                        <img src="@item.ActivityPoster"
                                             alt="@item.ActivityTopic Poster"
                                             style="width:90px;height:90px;object-fit:cover;border-radius:50%;border:3px solid #0f7179;box-shadow:0 4px 10px rgba(0,0,0,0.1);"
                                             onerror="this.src='https://placehold.co/100x100/f3f4f6/000000?text=No+Image'" />
                                    </div>
                                    <h6 class="text-primary" style="font-weight:600;">@item.ActivityTopic</h6>
                                    @if (!string.IsNullOrEmpty(item.ActivityDescription))
                                    {
                                        <p class="text-muted small">@item.ActivityDescription</p>
                                    }
                                </a>
                            </div>
                        </div>
                    }
                }
                else if (ViewContext.HttpContext.Request.Query.ContainsKey("clubGuid"))
                {
                    <!-- نادي مختار لكن لا توجد أنشطة -->
                    <div class="text-center text-muted py-5">
                        <p>لا توجد أنشطة لهذا النادي</p>
                    </div>
                }
                else
                {
                    <!-- لم يتم اختيار نادي -->
                    <div class="text-center text-muted py-5">
                        <p>اختر النادي أو ابحث لعرض الأنشطة</p>
                    </div>
                }
            </div>
        </div>
    </div>
</section>

<style>
    a {
        text-decoration: none;
    }

    .activity-item .card:hover {
        transform: translateY(-6px) scale(1.02);
        box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        cursor: pointer;
    }

    .table__quick_search {
        border: 1px solid #ddd;
        border-radius: 8px;
        padding: 8px 12px;
        width: 280px;
    }

        .table__quick_search:focus {
            border-color: #0f7179;
            box-shadow: 0 0 0 0.2rem rgba(15, 113, 121, 0.25);
            outline: none;

        }
</style>
