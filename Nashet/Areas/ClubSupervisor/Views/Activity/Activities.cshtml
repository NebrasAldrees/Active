@using Nashet.Business.ViewModels
@model IEnumerable<ActivityViewModel>
<section class="page_wrap">
    <div class="page_content">
        <div class="block mb-4">
            <div class="block-header border-bottom px-4 py-3">
                <h5 class="m-0">الأنشطة</h5>
                <div class="d-flex gap-2">
                    <div class="form-group">
                        <input type="text" id="searchInput" class="form-control table__quick_search"
                               placeholder="البحث عن نشاط ...">
                    </div>
                </div>
            </div>
            <div class="block-body mx-auto px-4 py-8">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 justify-items-center">

                    <div class="row" id="ActivitiesContainer">
                        <!-- Filter by club -->
                        <form method="get" asp-action="Activities" asp-controller="Activity" asp-area="ClubSupervisor" class="mb-10 w-full">
                            <div class="flex items-stretch md:items-center bg-white rounded shadow-sm p-3 input-shadow border border-gray-200">
                                <div class="flex items-center space-x-2 space-x-reverse mb-3 md:mb-0 md:ml-4 flex-shrink-0">
                                    <label for="selectedClub" class="text-lg font-semibold text-gray-700 whitespace-nowrap">النادي</label>
                                    @{
                                        var clubList = (IEnumerable<ClubViewModel>)ViewBag.Club;
                                        var queryGuid = ViewContext.HttpContext.Request.Query["clubGuid"];
                                        Guid ClubGuid = Guid.TryParse(queryGuid, out var parsedGuid) ? parsedGuid : Guid.Empty;
                                    }
                                    @Html.DropDownList("clubGuid",
                                    new SelectList(clubList, "Guid", "ClubNameAR", ClubGuid),
                                                                        "-- اختر النادي --",
                                                                        new { @class = "form-control", onchange = "this.form.submit()" })
                                </div>
                            </div>
                        </form>
                    </div>
                    <!-- view activities -->
                    <div class="row border-active-dark px-4 py-3" id="activitiesList">
                        @foreach (var item in Model)
                        {
                            <div class="border-hover-gray-300 col-12 col-sm-6 col-md-4 col-lg-3 mb-4 activity-item"
                                 data-search="@item.ActivityTopic.ToLower() @item.ActivityDescription?.ToLower()">
                                <a asp-action="ActivityPage" asp-route-guid="@item.Guid" asp-controller="Activity" asp-area="ClubSupervisor"
                                   class="d-block bg-white rounded shadow-sm text-center p-3 h-100">
                                    <img src="@item.ActivityPoster"
                                         alt="@item.ActivityTopic Poster"
                                         class="w-24 h-24 img-fluid mb-2"
                                         style="max-height: 100px; object-fit: contain;"
                                         onerror="this.src='https://placehold.co/100x100/f3f4f6/000000?text=No+Image'" />
                                    <h6 class="text-dark">@item.ActivityTopic</h6>
                                    @if (!string.IsNullOrEmpty(item.ActivityDescription))
                                    {
                                        <p class="text-muted small activity-description" style="display: none;">
                                            @item.ActivityDescription
                                        </p>
                                    }
                                </a>
                            </div>
                        }
                    </div>
                </div>
            </div>
        </div>

    </div>
</section>

@section Scripts {
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const searchInput = document.getElementById('searchInput');
            const activityItems = document.querySelectorAll('.activity-item');

            searchInput.addEventListener('input', function() {
                const searchTerm = this.value.toLowerCase().trim();

                activityItems.forEach(item => {
                    const searchData = item.getAttribute('data-search');
                    const activityTopic = item.querySelector('h6').textContent.toLowerCase();
                    const activityDescription = item.querySelector('.activity-description')?.textContent.toLowerCase() || '';

                    const matches = activityTopic.includes(searchTerm) ||
                                   activityDescription.includes(searchTerm) ||
                                   searchData.includes(searchTerm);

                    if (matches || searchTerm === '') {
                        item.style.display = 'block';
                    } else {
                        item.style.display = 'none';
                    }
                });
            });

            // Clear search when club filter changes
            document.querySelector('select[name="clubGuid"]').addEventListener('change', function() {
                searchInput.value = '';
                activityItems.forEach(item => {
                    item.style.display = 'block';
                });
            });
        });
    </script>
}

<style>
    a {
        text-decoration: none;
    }

    .activity-item {
        transition: all 0.3s ease;
    }

    .table__quick_search {
        border: 1px solid #ddd;
        border-radius: 5px;
        padding: 8px 12px;
        width: 300px;
    }

        .table__quick_search:focus {
            border-color: #0f7179;
            box-shadow: 0 0 0 0.2rem rgba(15, 113, 121, 0.25);
            outline: none;
        }
</style>