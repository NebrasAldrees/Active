<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
@model IEnumerable<ActivityRequestViewModel>

<!-- Start Page Wrap -->
<section class="page_wrap">
    <div class="page_content">

        <div class="block mb-4">
            <div class="block-header border-bottom px-4 py-3">
                <h5 class="m-0">الطلبات</h5>
                <div class="d-flex gap-2">
                    <div class="form-group">
                        <input type="text" class="form-control table__quick_search"
                               placeholder="البحث السريع ...">
                    </div>
                </div>
            </div>

            <div class="block-body">
                

                <table class="table table-hover js-dataTable">
                    <thead>
                        <tr>
                            <th>عنوان الطلب</th>
                            <th>النادي التابع للطلب </th>
                            <th>حالة الطلب <i class="fas fa-sort text-muted"></i></th>
                            <th>زمن رفع الطلب <i class="fas fa-sort text-muted"></i></th>
                            <th>الإجراءات</th>
                        </tr>
                    </thead>
                    <tbody>
                        @if (!Model.Any())
                        {
                            <tr>
                                <td colspan="4" class="text-center text-muted">لا توجد طلبات لعرضها حالياً</td>
                            </tr>
                        }
                        else
                        {
                            foreach (var item in Model)
                            {
                                <tr>
                                    <td>@item.ActivityTopic</td>
                                    <td>@(item.ClubNameAR ?? "غير محدد")</td>
                                    <td>@item.StatusTypeAr</td>
                                    <td>@item.CreationDate</td>
                                    <td class="text-end">
                                        <a asp-action="RequestDetails" asp-route-guid="@item.Guid" asp-controller="ActivityRequest" asp-area="ActivitiesSupervisor"
                                           class="btn btn-sm btn-primary">عرض التفاصيل</a>
                                    </td>
                                </tr>
                            }
                        }
                    </tbody>
                </table>
            </div>
        </div>

    </div>
</section>
<!-- End Page Wrap -->
@section Scripts {
    <script>
        $(document).ready(function () {
            // Custom sort for Arabic status
            $.fn.dataTable.ext.order['status-priority'] = function (settings, col) {
                return this.api().column(col, { order: 'index' }).nodes().map(function (td, i) {
                    const status = $(td).text().trim();
                    switch (status) {
                        case 'قيد الانتظار': return 1; // Pending
                        case 'تمت الموافقة': return 2; // Approved
                        case 'مرفوض': return 3; // Rejected
                        default: return 99; // Unknown
                    }
                });
            };

                var table = $('.js-dataTable');

        if (!$.fn.DataTable.isDataTable(table)) {
            table.DataTable({
                order: [[3, 'desc']], // Sort by creation date
                language: {
                    url: '//cdn.datatables.net/plug-ins/1.13.6/i18n/ar.json'
                }
            });
        }

        });
    </script>
}