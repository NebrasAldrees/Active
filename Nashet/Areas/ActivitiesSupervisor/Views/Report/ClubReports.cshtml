@model IList<ReportViewModel>
@{
    ViewData["Title"] = "تقارير النادي";
    var clubName = ViewBag.ClubName ?? "غير معروف";
    var clubGuid = ViewBag.ClubGuid;
}

<section class="page_wrap">
    <div class="page_content">
        <div class="block mb-4">
            <!-- Header -->
            <div class="block-header border-bottom px-4 py-3">
                <div class="d-flex justify-content-between align-items-center">
                    <h5 class="m-0">تقارير النادي - @clubName</h5>
                    <div class="d-flex gap-2">
                        <div class="form-group">
                            <input type="text" class="form-control table__quick_search"
                                   placeholder="البحث السريع ...">
                        </div>
                        
                    </div>
                </div>
            </div>

            <!-- Content -->
            <div class="block-body p-4">
                <!-- رسائل التنبيه -->
                @if (TempData["Success"] != null)
                {
                    <div class="alert alert-success alert-dismissible fade show mb-4" role="alert">
                        <i class="fas fa-check-circle me-2"></i> @TempData["Success"]
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    </div>
                }

                @if (TempData["Error"] != null)
                {
                    <div class="alert alert-danger alert-dismissible fade show mb-4" role="alert">
                        <i class="fas fa-times-circle me-2"></i> @TempData["Error"]
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    </div>
                }

                @if (Model == null || !Model.Any())
                {
                    <div class="text-center py-5">
                        <i class="fas fa-file-alt fa-3x text-muted mb-3"></i>
                        <h5 class="text-muted">لا توجد تقارير</h5>
                        <p class="text-muted">لم يتم إضافة أي تقارير لهذا النادي بعد</p>
                    </div>
                }
                else
                {
                    <table class="table table-hover js-dataTable">
                        <thead>
                            <tr>
                                <th>الرقم المرجعي للتقرير</th>
                                <th>عنوان التقرير</th>
                                <th>تاريخ الإضافة</th>
                                <th></th>
                                <th class="text-center"></th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var item in Model)
                            {
                                <tr>
                                    <td>@item.ReportId</td>
                                    <td>
                                        <div class="d-flex align-items-center">
                                            @* @{
                                                string GetFileIcon(string path)
                                                {
                                                    var extension = Path.GetExtension(path ?? "").ToLower();
                                                    return extension switch
                                                    {
                                                        ".pdf" => "fa-file-pdf text-danger",
                                                        ".doc" or ".docx" => "fa-file-word text-primary",
                                                        ".xls" or ".xlsx" => "fa-file-excel text-success",
                                                        ".jpg" or ".jpeg" or ".png" => "fa-file-image text-info",
                                                        ".txt" => "fa-file-alt text-secondary",
                                                        _ => "fa-file text-muted"
                                                    };
                                                }
                                            } *@
                                            @* <i class="fas @GetFileIcon(item.Path) me-2"></i> *@
                                            @item.Topic
                                        </div>
                                    </td>
                                    <td>@item.CreationDate.ToString("yyyy/MM/dd")</td>
                                    <td>
                                        @if (item.isSent)
                                        {
                                            <span class="badge bg-success">مرسل</span>
                                        }
                                        else
                                        {
                                            <span class="badge bg-warning">مسودة</span>
                                        }
                                    </td>
                                    <td class="action_td text-center">
                                        <div class="btn-group" role="group">
                                            <!-- زر التنزيل -->
                                            <a href="@item.Path" download class="btn btn-sm btn-primary"
                                               title="تنزيل التقرير">
                                                <i class="fas fa-download"></i> تنزيل
                                            </a>
                                        </div>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                }
            </div>
        </div>

        <!-- زر العودة -->
        <div class="text-center mt-4">
            <a href="@Url.Action("ClubPage", "Club", new { area = "ActivitiesSupervisor", guid = clubGuid })"
               class="btn btn-outline-secondary">
                <i class="fas fa-arrow-right me-1"></i> العودة إلى صفحة النادي
            </a>
        </div>
    </div>
</section>

@section Scripts {
    <script>
        // البحث السريع في الجدول
        document.querySelector('.table__quick_search').addEventListener('input', function(e) {
            const searchText = e.target.value.toLowerCase().trim();
            const rows = document.querySelectorAll('tbody tr');

            rows.forEach(row => {
                const rowText = row.textContent.toLowerCase();
                if (rowText.includes(searchText) || searchText === '') {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        });

        // إذا كان لديك DataTables، يمكنك تفعيله
        $(document).ready(function() {
            if ($.fn.DataTable) {
                $('.js-dataTable').DataTable({
                    language: {
                        url: '//cdn.datatables.net/plug-ins/1.13.6/i18n/ar.json'
                    },
                    responsive: true,
                    order: [[0, 'desc']] // ترتيب حسب الرقم المرجعي تنازلياً
                });
            }
        });
    </script>
}

<style>
    .action_td .btn-group .btn {
        margin: 0 2px;
        border-radius: 4px;
    }

    .table-hover tbody tr:hover {
        background-color: rgba(0, 0, 0, 0.04);
    }

    .badge {
        font-size: 0.75em;
    }

    .fas {
        font-size: 0.9em;
    }
</style>